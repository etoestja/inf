\documentclass[a4paper]{article}
\usepackage[a4paper, left=5mm, right=5mm, top=5mm, bottom=5mm]{geometry}
%\geometry{paperwidth=210mm, paperheight=2000pt, left=5pt, top=5pt}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{indentfirst}
\usepackage{tikz} %Рисование автоматов
\usetikzlibrary{automata,positioning,arrows,trees}
\usepackage{amsmath}
\usepackage{enumerate}
\usepackage[makeroom]{cancel} % зачеркивание
\usepackage{multicol} %Несколько колонок
\usepackage{hyperref}
\usepackage{tabularx}
\usepackage{amsfonts}
\usepackage{amssymb}
\DeclareMathOperator*{\argmin}{arg\,min}
\usepackage{wasysym}
\title{Теория и реализация языков программирования.\\Задание 10: LL-анализ}
\date{задано 2013.11.13}
\author{Сергей~Володин, 272 гр.}
\newcommand{\matrixl}{\left|\left|}
\newcommand{\matrixr}{\right|\right|}
% названия автоматов  (rubtsov)
\def\A{{\cal A}}
\def\B{{\cal B}}
\def\C{{\cal C}}

%+= и -=, иначе разъезжаются...
\newcommand{\peq}{\mathrel{+}=}
\newcommand{\meq}{\mathrel{-}=}
\newcommand{\deq}{\mathrel{:}=}
\newcommand{\plpl}{\mathrel{+}+}

% пустое слово  (rubtsov)
\def\eps{\varepsilon}

% регулярные языки  (rubtsov)
\def\REG{{\mathsf{REG}}}
\def\CFL{{\mathsf{CFL}}}
\def\eqdef{\overset{\mbox{\tiny def}}{=}}
\newcommand{\niton}{\not\owns}

%FIRST & FOLLOW (rubtsov)
\def\first{\mathrm{ FIRST} }
\def\follow{\mathrm{ FOLLOW} }

\newcounter{rowItemCount}
\newcounter{subRowItemCount}
\newcommand\rowItem{
    \setcounter{subRowItemCount}{0}
    \arabic{rowItemCount}.\addtocounter{rowItemCount}{1}}
\newcommand\subRowItem{
    \addtocounter{subRowItemCount}{1}
    \addtocounter{rowItemCount}{-1}
    \arabic{rowItemCount}.\arabic{subRowItemCount}.\addtocounter{rowItemCount}{1}}

\begin{document}
\maketitle
\subsection*{Упражнение 1}
Пусть $G=(N,T,P,S)$. Занумеруем правила из $P$: $P=\{P_1,...,P_n\}$.\newline
Определим синтаксический перевод $T_l=(N, T, T', R, S)$:\begin{enumerate}
\item $T'=\{1,...,n\}$
\item $R$ определяется через $P$: каждому правилу $P\ni P_i=(X,Y_1...Y_n)$ сопоставим правила в $R$: пусть $Y_{j_1}...Y_{j_l}$~--- максимальная подпоследовательность из нетерминалов из слова $Y_1...Y_n$. Тогда $X\longrightarrow Y_1...Y_n,iY_{j_1}...Y_{j_l})\in P'$.\newline
По построению нетерминалы, входящие в $\alpha\equiv Y_1...Y_n$ входят также в $\beta\equiv Y_{j_1}...Y_{j_l}$, причем с той же кратностью.
\end{enumerate}
Докажем, что слово $w\in L(G)$ переводится в левый вывод $w$. {\bf TODO}
\subsection*{Упражнение 2}
$w=a*(a+a)$. Построим правый вывод по дереву вывода (из задания):\newline
\begin{tabular}{ll}
\begin{minipage}{0.4\textwidth}
\begin{tikzpicture}
	\node {$E$} %root
		child{ node{$2$} }
		child{ node   {$T$}
			child{ node{$3$} }
		 	child{ node {$T$}
				child{ node{$4$} }				
				child[sibling angle=90,clockwise from=0]{ node{$F$}
					child[sibling angle=0,clockwise from=270]{ node {$6$} }
				}
			}
			child{ node {$F$}
				child{ node {$5$}  }
				child{ node {$E$} 
					child{ node{$1$} } 
					child{ node{$E$}
						child{ node{$2$} }
						child[sibling angle=90,clockwise from=0]{ node{$T$}
							child[sibling angle=0,clockwise from=270]{ node{$4$} }
							child[level distance = 1.75cm, sibling angle=0,clockwise from=300]{ node{$F$}
								child[sibling angle=0,clockwise from=270]{ node {$6$} }
							}
						}
					}
					child{ node{$T$}
						child{ node{$4$} }
						child{ node{$F$}
							child{ node {$6$} }
						}
					}
				}
			}
	};
\end{tikzpicture}
\end{minipage} &
\begin{minipage}{0.5\textwidth}
Чтобы получить правый вывод, обойдем дерево разбора в $G'$ следующим образом:
\begin{enumerate}
\item Выпишем самого левого потомка (по структуре правил, это всегда будет номер правила из $G$)
\item Выполним разбор оставшихся потомков справа налево.
\end{enumerate}
\end{minipage}\\
\end{tabular}
\newline
Получаем последовательность правил правого вывода $w$ в $G$: $P_r=23514624646$.\newline
Правый вывод {\em (выделен раскрываемый нетерминал)}: $\underline{E}\overset{2}{\Rightarrow}\underline{T}\overset{3}{\Rightarrow}T*\underline{F}\overset{5}{\Rightarrow}T*(\underline{E})\overset{1}{\Rightarrow}T*(E+\underline{T})\overset{4}{\Rightarrow}T*(E+\underline{F})\overset{6}{\Rightarrow}T*(\underline{E}+a)\overset{2}{\Rightarrow}T*(\underline{T}+a)\overset{4}{\Rightarrow}T*(\underline{F}+a)\overset{6}{\Rightarrow}\underline{T}*(a+a)\overset{4}{\Rightarrow}\underline{F}*(a+a)\overset{6}{\Rightarrow}a*(a+a)=w$.\newline
По определению, правый разбор~--- примененнные при правом выводе правила в обратном порядке: $(P_r)^R=64642641532$.
\subsection*{Упражнение 3}
\subsection*{Упражнение 4}
\subsection*{Упражнение 5}
\subsection*{Упражнение 6}
\newpage
\subsection*{Задача 1}
$w=((a))\in L(G)$: $\underline{E}\overset{2}{\Rightarrow}\underline{T}\overset{4}{\Rightarrow}\underline{F}\overset{5}{\Rightarrow}(\underline{E})\overset{2}{\Rightarrow}(\underline{T})\overset{4}{\Rightarrow}(\underline{F})\overset{5}{\Rightarrow}((E))\overset{2}{\Rightarrow}((\underline{T}))\overset{4}{\Rightarrow}((\underline{F}))\overset{6}{\Rightarrow}((a))$.\begin{enumerate}
\item Построим дерево вывода $w$ в $G$ и соответствующее дерево в $G'$:
	\begin{multicols}{2}
		\begin{flushleft}
			
		\begin{tikzpicture}
			\node {$E$} %root
				child
				{
					node {$T$}
					child
					{ 
						node {$F$}
						child
						{
							node {$($}
						}
						child
						{
							node {$E$}	
							child
							{
								node{$T$}
								child
								{
									node{$F$}
									child
									{
										node {$($}
									}
									child
									{
										node {$E$}
										child
										{
											node {$T$}
											child
											{
												node {$F$}
												child
												{
													node {$a$}
												}
											}
										}
									}
									child
									{
										node {$)$}
									}
								}
							}
						}
						child
						{
							node {$)$}
						}
					}
				};
		\end{tikzpicture}
		\end{flushleft}
		
		\begin{flushright}
			
		\begin{tikzpicture}
%						child[sibling angle=90,clockwise from=0]{ node{$fF$}
			\node {$E$} %root
				child {node {$2$}}
				child
				{
					node {$T$}
					child {node {$4$}}
					child
					{ 
						node {$F$}
						child {node {$5$}}
						child
						{
							node {$E$}	
							child {node {$2$}}
							child
							{
								node{$T$}
								child {node {$4$}}
								child
								{
									node{$F$}
									child {node {$5$}}
									child
									{
										node {$E$}
										child {node {$2$}}
										child
										{
											node {$T$}
											child {node {$4$}}
											child
											{
												node {$F$}
												child {node {$6$}}
											}
										}
									}
								}
							}
						}
					}
				};
		\end{tikzpicture}
		\end{flushright}	
	\end{multicols}
\item Левый разбор: обойдем второе дерево в глубину, всегда выбирая самого левого непосещенного потомка: $P_l=245245246$.
\item Правый разбор: обойдем второе дерево в глубину, как указано в решении упражнения 2: $(P_r)^R=245245246\Rightarrow P_r=642542542$.
\end{enumerate}
\subsection*{Задача 2}
\begin{enumerate}
\item $\Sigma=\{0,1\}$, $N=\{S\}$, $G=(N,\Sigma,P,S)$, $P=\big\{\overbrace{S\to 0S}^{(1)},\overbrace{S\to 1S}^{(2)},\overbrace{S\to \varepsilon}^{(3)}\big\}$.
\item Вычислим $\first$:\newline
\begin{tabular}{rl|c|c|c|}
& & $F_i(0)$ & $F_i(1)$ & $F_i(S)$\\ \hline
\rowItem & Определим $F_0$: & $\varnothing$ & $\varnothing$ & $\varnothing$\\
\subRowItem & Терминалы: $F_0(0)\eqdef \{0\}$, $F_0(1)\eqdef \{1\}$. & $\{0\}$ & $\{1\}$ & $\varnothing$\\
\subRowItem & Нетерминалы: есть правило $S\overset{(3)}{\to}\varepsilon\Rightarrow F_0(S)\eqdef\{\varepsilon\}$ & $\{0\}$ & $\{1\}$ & $\{\varepsilon\}$\\
\rowItem & Определим $F_1=F_0$ & $\{0\}$ & $\{1\}$ & $\{\varepsilon\}$\\
\subRowItem & Рассмотрим правило $S\overset{(1)}{\to}\underline{0}S$. $F_0(\underline{0})=\{0\}\niton\varepsilon\Rightarrow F_1(S)\leftarrow \{0\}$ & $\{0\}$ & $\{1\}$ & $\{\varepsilon,0\}$ \\
\subRowItem & Рассмотрим правило $S\overset{(2)}{\to}\underline{1}S$. $F_0(\underline{1})=\{1\}\niton\varepsilon\Rightarrow F_1(S)\leftarrow \{1\}$ & $\{0\}$ & $\{1\}$ & $\{\varepsilon,0,1\}$ \\
\subRowItem & Рассмотрим правило $S\overset{(3)}{\to}\underline{\varepsilon}$. $|\underline{\varepsilon}|=0\Rightarrow$ не изменяем $F_1$ & $\{0\}$ & $\{1\}$ & $\{\varepsilon,0,1\}$ \\
\rowItem & Определим $F_2=F_1$: & $\{0\}$ & $\{1\}$ & $\{\varepsilon,0,1\}$\\
\subRowItem & Рассмотрим правило $S\overset{(1)}{\to}\underline{0}S$. $F_1(\underline{0})=\{0\}\niton\varepsilon\Rightarrow F_2(S)\leftarrow \{0\}$ & $\{0\}$ & $\{1\}$ & $\{\varepsilon,0,1\}$ \\
\subRowItem & Рассмотрим правило $S\overset{(2)}{\to}\underline{1}S$. $F_1(\underline{1})=\{1\}\niton\varepsilon\Rightarrow F_2(S)\leftarrow \{1\}$ & $\{0\}$ & $\{1\}$ & $\{\varepsilon,0,1\}$ \\
\subRowItem & Рассмотрим правило $S\overset{(3)}{\to}\underline{\varepsilon}$. $|\underline{\varepsilon}|=0\Rightarrow$ не изменяем $F_2$ & $\{0\}$ & $\{1\}$ & $\{\varepsilon,0,1\}$ \\
\subRowItem & Имеем $F_2=F_1$ $\Rightarrow$ выход & $\{0\}$ & $\{1\}$ & $\{\varepsilon,0,1\}$ \\\hline
\end{tabular}
\item Вычислим $\follow$:\newline
\setcounter{subRowItemCount}{0}
\setcounter{rowItemCount}{0}
\begin{tabular}{rl|c|}
& & $F_i(S)$\\ \hline
\rowItem & Определим $F_0$: & $\varnothing$\\
\rowItem & Определим $F_1=F_0$: & $\varnothing$\\\hline
\subRowItem & Рассмотрим правило $\underbrace{S}_A\overset{(1)}{\to}\underbrace{0}_\alpha\underbrace{S}_X\underbrace{\varepsilon}_{\beta}$
\begin{minipage}{0.45\textwidth}\begin{enumerate}
\item $\first(\beta)=\{\varepsilon\}\Rightarrow\first(\beta)\setminus\{\varepsilon\}=\varnothing\to F_1(S)$.
\item $\varepsilon\in\first(\beta)$, поэтому $F_1(S)\leftarrow F_0(S)=\varnothing$
\end{enumerate}\end{minipage} & $\varnothing$\\\hline
\subRowItem & Рассмотрим правило $\underbrace{S}_A\overset{(2)}{\to}\underbrace{1}_\alpha\underbrace{S}_X\underbrace{\varepsilon}_{\beta}$
\begin{minipage}{0.45\textwidth}\begin{enumerate}
\item $\first(\beta)=\{\varepsilon\}\Rightarrow\first(\beta)\setminus\{\varepsilon\}=\varnothing\to F_1(S)$.
\item $\varepsilon\in\first(\beta)$, поэтому $F_1(S)\leftarrow F_0(S)=\varnothing$
\end{enumerate}\end{minipage} & $\varnothing$\\\hline
\subRowItem & Рассмотрим правило $\underbrace{S}_A\overset{(3)}{\to}\varepsilon$. Оно не имеет вид $A\to \alpha X\beta$, не изменяем $F_1$& $\varnothing$\\\hline
\subRowItem & Имеем $F_1=F_0$ $\Rightarrow$ выход & $\varnothing$\\\hline
\end{tabular}
\item Таблица переходов для $LL(1)$-анализатора:\newline
\begin{tabular}{|l|l|l|}
\hline
& $0$ & $1$\\\hline
S & $S\overset{(1)}{\to}0S$ & $S\overset{(1)}{\to}1S$\\\hline
0 & $\varepsilon$ & {\bf Err.}\\\hline
1 & {\bf Err.} & $\varepsilon$\\\hline
\end{tabular}
\end{enumerate}
\subsection*{Задача 3}
\subsection*{Задача 4}
\subsection*{Задача 5}
\subsection*{Задача 6}
\end{document}