\documentclass[a4paper]{article}
\usepackage[a4paper, left=5mm, right=5mm, top=5mm, bottom=5mm]{geometry}
%\geometry{paperwidth=210mm, paperheight=2000pt, left=5pt, top=5pt}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{indentfirst}
\usepackage{tikz} %Рисование автоматов
\usetikzlibrary{automata,positioning,arrows,trees,calc}
\usepackage{amsmath}
\usepackage[makeroom]{cancel} % зачеркивание
\usepackage{multicol,multirow} %Несколько колонок
\usepackage{hyperref}
\usepackage{tabularx}
\usepackage{amsfonts}
\usepackage{amssymb}
\DeclareMathOperator*{\argmin}{arg\,min}
\usepackage{listings}
\usepackage{wasysym}
\date{задано 2014.03.27}
\author{Сергей~Володин, 272 гр.}
\newcommand{\matrixl}{\left|\left|}
\newcommand{\matrixr}{\right|\right|}
% названия автоматов  (rubtsov)
\def\A{{\cal A}}
\def\B{{\cal B}}
\def\C{{\cal C}}

%классы сложности (rubtsov)
\def\PP{{\mathsf{P}}}
\def\NP{{\mathsf{NP}}}
\def\NPc{{\mathsf{NP}}\text{-}{\rm c}}
\def\coNP{{\rm co}\text{-}{\mathsf{NP}}}
\def\DTIME{{\mathsf{DTIME}}}
\def\NTIME{{\mathsf{NTIME}}}
\def\CLIQUE{{\mathsf{CLIQUE}}}
\def\HALT{{\rm{HALT}}}
\def\SAT{{\rm{SAT}}}
\def\3SAT{{\rm{3\text{-}SAT}}}
\def\2SAT{{\rm{2\text{-}SAT}}}
\def\UNSAT{{\rm{UNSAT}}}
\def\HP{{\rm{HAMPATH}}}
\def\UHP{{\rm{UHAMPATH}}}
\def\LL{{\mathrm{LL}}}
\def\poly{{\rm{poly}}}
\def\GC{{\mbox{ГЦ}}}
\def\GP{{\mbox{ГП}}}

\title{Алгоритмы и модели вычислений.\\Задание 7: потоки}

% алгоритмы (Рубцов)
\usepackage{verbatim}
\usepackage{listings}
\usepackage{algorithm2e}

%+= и -=, иначе разъезжаются...
\newcommand{\peq}{\mathrel{+}=}
\newcommand{\meq}{\mathrel{-}=}
\newcommand{\deq}{\mathrel{:}=}
\newcommand{\plpl}{\mathrel{+}+}

\newcommand{\todo}{{\em todo}}

% пустое слово  (rubtsov)
\def\eps{\varepsilon}

% регулярные языки  (rubtsov)
\def\REG{{\mathsf{REG}}}
\def\CFL{{\mathsf{CFL}}}
\def\eqdef{\overset{\mbox{\tiny def}}{=}}
\newcommand{\niton}{\not\owns}

%FIRST & FOLLOW (rubtsov)
\def\first{\mathrm{ FIRST} }
\def\follow{\mathrm{ FOLLOW} }

% LL LR (rubtsov)
\def\LL{{\mathrm{LL}}}
\def\LR{{\mathrm{LR}}}

\newcounter{rowItemCount}
\newcounter{subRowItemCount}
\newcommand\rowItem{
    \setcounter{subRowItemCount}{0}
    \arabic{rowItemCount}.\addtocounter{rowItemCount}{1}}
\newcommand\subRowItem{
    \addtocounter{subRowItemCount}{1}
    \addtocounter{rowItemCount}{-1}
    \arabic{rowItemCount}.\arabic{subRowItemCount}.\addtocounter{rowItemCount}{1}}
    
\newcommand{\smalll}[1]{\overline{\overline{#1}}}
\newcommand{\smallo}{\bar{\bar{o}}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\Nz}{\mathbb{N}\cup\{0\}}
\begin{document}
\maketitle
\subsection*{Определения}
{\em (сюда будут ссылки)}\newline
$(G(V,E)$, $c\colon V^2\to\Nz, s, t)$~--- транспортная сеть $\Leftrightarrow$ \begin{enumerate}
\item \label{defNCg0}$c(u,v)\geqslant 0$
\item \label{defNCE} $\forall (u,v)\in V^2\hookrightarrow \big((u,v)\in E\Leftrightarrow c(u,v)>0\big)$
\end{enumerate}
$f\colon V^2\to\ZZ$~--- поток в этой сети $\Leftrightarrow$\begin{enumerate}
\item \label{defFl} $\forall(u,v)\in V^2\hookrightarrow \big(f(u,v)\leqslant c(u,v)\big)$
\item \label{defFs} $\forall(u,v)\in V^2\hookrightarrow \big(f(u,v)=-f(v,u)\big)$
\item \label{defFc} $\forall u\in V^2\setminus\{s,t\}\hookrightarrow f(u,V)=0$
\end{enumerate}
\subsection*{Упражнение 0}
\begin{enumerate}
\item \label{uvvu0} Пусть $(G(V,E)$, $c\colon V^2\to\Nz, s, t)$~--- транспортная сеть. Пусть $(u,v)\notin E$, $(v,u)\notin E$. Тогда $f(u,v)=f(v,u)=0$.\newline
$(u,v)\notin E\overset{\ref{defNCE}}{\Rightarrow} c(u,v)=0$. $(v,u)\notin E\overset{\ref{defNCE}}{\Rightarrow} c(v,u)=0$. Но $-0=-c(v,u)\overset{\ref{defFl}}{\leqslant} -f(v,u)\overset{\ref{defFs}}{=}\underline{f(u,v)}\overset{\ref{defFl}}{\leqslant} c(u,v)=0$, откуда $f(u,v)=f(v,u)=0\,\blacksquare$
\end{enumerate}
\subsection*{Упражнение 1}
Пусть $(G(V,E)$, $c\colon V^2\to\Nz, s, t)$~--- транспортная сеть. Фиксируем $u\notin\{s,t\}$. Пусть $L=\{v\in V\big| (v,u)\in E\}$, $R=\{v\in V\big|(u,v)\in E\}$~--- вершины, из которых (в которые, соответственно) есть ребра в фиксированную. Тогда $f(L,u)=f(u,R)$.\newline
Найдем $$0\overset{\ref{defFc}}{=}f(u,V)\equiv\sum\limits_{v\in V}f(u,v)=
\underbrace{\sum\limits_{\substack{v\in V\\ (u,v)\in E\\ (v,u)\in E}}f(u,v)}_{S_1}+
\underbrace{\sum\limits_{\substack{v\in V\\ (u,v)\in E\\ (v,u)\notin E}}f(u,v)}_{S_2}+
\underbrace{\sum\limits_{\substack{v\in V\\ (u,v)\notin E\\ (v,u)\in E}}f(u,v)}_{S_3}+
\underbrace{\sum\limits_{\substack{v\in V\\ (u,v)\notin E\\ (v,u)\notin E}}f(u,v)}_{S_4}$$
$(u,v)\notin E$, $(v,u)\notin E$ $\overset{\ref{uvvu0}}{\Rightarrow}$ $f(u,v)=0$, поэтому $S_4=0$. Рассмотрим $S_1=\sum\limits_{\substack{v\in V\\ (u,v)\in E\\ (v,u)\in E}}f(u,v)\overset{\ref{defFs}}{=}\sum\limits_{\substack{v\in V\\ (u,v)\in E\\ (v,u)\in E}}(-f(v,u))=-\sum\limits_{\substack{v\in V\\ (u,v)\in E\\ (v,u)\in E}}f(v,u)\boxed{=}$. Переобозначим вершины, получим $\boxed{=}-\sum\limits_{\substack{u\in V\\ (v,u)\in E\\ (u,v)\in E}}f(u,v)=-S_1$, откуда $S_1=0$.\newline
Рассмотрим $f(L,u)=\sum\limits_{(v,u)\in E}f(v,u)=-\sum\limits_{(v,u)\in E}f(u,v)=-(S_1+S_3)\overset{S_1=0}{\equiv} -S_3$\newline
Рассмотрим $f(u,R)=\sum\limits_{(u,v)\in E}f(u,v)=S_1+S_2\overset{S_1=0}{\equiv}S_2$.\newline
Из $(*)$ получаем $0\overset{S_1=0}{\underset{S_4=0}{=}}S_2+S_3$, откуда $S_2=-S_3$, и $f(L,u)=f(u,R)\,\blacksquare$
\newpage
\subsection*{Упражнение 2}
\label{fst} Пусть $(G(V,E)$, $c\colon V^2\to\Nz, s, t)$~--- транспортная сеть. $f$~--- поток в ней.\newline
Рассмотрим $A\eqdef\sum\limits_{\substack{u\in V\\v\in V}} f(u,v)$. Переобозначим, получим $A=\sum\limits_{\substack{v\in V\\u\in V}}f(v,u)\overset{\ref{defFs}}{=}-\sum\limits_{\substack{v\in V\\u\in V}}f(u,v)=-A$, откуда $A=0$\newline
Но $A=\underbrace{\sum\limits_{\substack{u=s\\v\in V}}f(u,v)}_{S_1}+\underbrace{\sum\limits_{\substack{u=t\\v\in V}}f(u,v)}_{S_2}+\underbrace{\sum\limits_{\substack{u\in V\setminus \{s,t\}\\v\in V}}f(u,v)}_{S_3}$.\newline
Рассмотрим $S_3=\sum\limits_{u\in V\setminus\{s,t\}}\underline{\sum\limits_{v\in V}f(u,v)}$. По свойству $\ref{defFc}$ каждая подчеркнутая часть равна $0$, и $S_3=0$\newline
Рассмотрим $S_1=\sum\limits_{v\in V}f(s,v)\equiv |f|$\newline
Рассмотрим $S_2=\sum\limits_{v\in V}f(t,v)\overset{\ref{defFs}}{=} -\sum\limits_{v\in V}f(v,t)=-f(V,t)$.\newline
Поскольку $0=A=S_1+S_2$, получаем $|f|=f(V,t)\,\blacksquare$
\subsection*{Задача 1}
Пусть $(G(V,E)$, $c\colon V^2\to\Nz, s, t)$~--- транспортная сеть. $f$~--- поток в ней.
\begin{enumerate}
\item \label{FAXX} Пусть $X\subseteq V$. Рассмотрим $A\eqdef f(X,X)\equiv \sum\limits_{\substack{u\in X\\v\in X}}f(u,v)$. Переобозначим, получим $$A=\sum\limits_{\substack{v\in X\\u\in X}}f(v,u)\overset{\ref{defFs}}{=}-\sum\limits_{\substack{v\in X\\u\in X}}f(u,v)=-A,$$
откуда $A=0\,\blacksquare$
\item \label{FAs} Пусть $X,\,Y\subseteq V$. Рассмотрим $f(X, Y)\equiv\sum\limits_{\substack{x\in X\\y\in Y}}f(x,y)\overset{\ref{defFs}}{=}-\sum\limits_{\substack{x\in X\\y\in Y}}f(y,x)\equiv -f(Y,X)\,\blacksquare$
\item \label{FAu} Пусть $X,\,Y,\,Z\subseteq V$, $X\cap Y=\varnothing$. Рассмотрим $f(X\cup Y, Z)\overset{(*)}{\equiv}\sum\limits_{\substack{u\in X\cup Y\\ v\in Z}}f(u,v)=
\underbrace{\sum\limits_{\substack{u\in X\\u\in Y\\ v\in Z}}f(u,v)}_{S_1}+
\underbrace{\sum\limits_{\substack{u\in X\\u\notin Y\\ v\in Z}}f(u,v)}_{S_2}+
\underbrace{\sum\limits_{\substack{u\notin X\\u\in Y\\ v\in Z}}f(u,v)}_{S_3}$.\newline
$S_1=0$, так как $u\in X\,\wedge\,u\in Y\Leftrightarrow u\in X\cap Y\Leftrightarrow u\in\varnothing$\newline
По определению, $f(X,Z)=\sum\limits_{\substack{u\in X\\u\in Y\\v\in Z}}f(u,v)+\sum\limits_{\substack{u\in X\\u\notin Y\\v\in Z}}f(u,v)\equiv S_1+S_2\overset{S_1=0}{=}S_2$\newline
По определению, $f(Y,Z)=\sum\limits_{\substack{u\in Y\\u\in X\\v\in Z}}f(u,v)+\sum\limits_{\substack{u\in Y\\u\notin X\\v\in Z}}f(u,v)\equiv S_1+S_3\overset{S_1=0}{=}S_3$\newline
Тогда из $(*)$ получаем $f(X\cup Y,Z)=S_2+S_3=f(X,Z)+f(Y,Z)$.
\item Пусть $X,\,Y,\,Z\subseteq V$, $X\cap Y=\varnothing$. Тогда $f(Z,X\cup Y)\overset{\ref{FAs}}{=}-f(X\cup Y,Z)\overset{\ref{FAu}}{=}-(f(X,Z)+f(Y,Z)\equiv -f(X,Z)-f(Y,Z)\overset{\ref{FAs}}{=}f(Z,X)+f(Z,Y)$
\end{enumerate}
\subsection*{Задача 2}
Нет, не обязательно. Пример. Рассмотрим $(G(V,E)$, $c\colon V^2\to\Nz, s, t)$~--- транспортная сеть. $f$~--- поток в ней:\newline
\begin{tikzpicture}[shorten >=1pt,node distance=2cm,on grid,auto,initial text=]
	  \node[state] (s) {$s$};
	  \node[state] (t)  [right = of s] {$t$};
  	  \path[->] 
			(s)	edge node {$1/1$}	(t)
			;
\end{tikzpicture}\newline
Определим $V\supseteq X\eqdef\{s\}$, $Y\eqdef X$. Тогда $A=f(X,Y)\overset{X=Y}{\equiv} f(X,X)\overset{\ref{FAXX}}{=}0$.\newline
Рассмотрим $B=-f(V-X,Y)\equiv f(\{t\},\{s\})=-\sum\limits_{\substack{u\in\{t\}\\v\in\{s\}}}f(u,v)\equiv -f(t,s)\overset{\ref{defFs}}{=}f(s,t)=1$\newline
Получаем $A=0\neq 1=B\,\blacksquare$
\subsection*{Упражнение 3}
\label{Fsum} Пусть $(G(V,E)$, $c\colon V^2\to\Nz, s, t)$~--- транспортная сеть. $f_1$ и $f_2$~--- потоки, для которых выполнено $\ref{defFc}$, $\ref{defFs}$ (заметим, что функция $c$ не участвует в этой части определения).\newline
Определим функцию $f\colon V^2\to \mathbb{R}$ как $f(u,v)\eqdef f_1(u,v)+f_2(u,v)$. По определению, $f$~--- поток в данной транспортной сети $\Leftrightarrow$ \begin{enumerate}
\item [3.] \ref{defFc}. Фиксируем $u\in V$. Рассмотрим $f(u,V)=\sum\limits_{\substack{v\in V}}f(u,v)=\sum\limits_{\substack{v\in V}}\big[f_1(u,v)+f_2(u,v)\big]\equiv\sum\limits_{\substack{v\in V}}f_1(u,v)+\sum\limits_{\substack{v\in V}}f_2(u,v)\equiv \cancelto{0}{f_1(u,V)}+\cancelto{0}{f_2(u,V)}=0$~--- выполнено всегда (зачеркнуто по свойству $\ref{defFc}$).
\item [2.] \ref{defFs}. Фиксируем $(u,v)\in V^2$. Рассмотрим $f(u,v)\equiv f_1(u,v)+f_2(u,v)\overset{\ref{defFs}}{=}-f_1(v,u)-f_2(v,u)\equiv -(f_1(v,u)+f_2(v,u))=-f(v,u)$~--- выполнено всегда.
\item [1.] \ref{defFl}. Нужно: $\forall (u,v)\in V^2\hookrightarrow f(u,v)\leqslant c(u,v)$. Поэтому третье свойство выполнено для $f$ $\Leftrightarrow$ $\forall (u,v)\in V^2\hookrightarrow f_1(u,v)+f_2(u,v)\leqslant c(u,v)$.
\end{enumerate}
Поэтому сумма потоков $f_1+f_2$~--- поток $\Leftrightarrow$ $\boxed{\forall (u,v)\in V^2\hookrightarrow f_1(u,v)+f_2(u,v)\leqslant c(u,v)}$.
\subsection*{Упражнение 4}
Пусть $N=(G(V,E)$, $c\colon V^2\to\Nz, s, t)$~--- транспортная сеть. Пусть $f_1$~--- поток в ней. Пусть $N'=(G'(u,v), c',s,t)$~--- остаточная сеть для $N$ и $f_1$. Пусть найден увеличивающий путь в остаточной сети, т.е. последовательность вершин $s\equiv v_0\to v_1\to ...\to v_{k-1}\to v_k\equiv t$, такая, что
$M\eqdef \min\limits_{i\in\overline{0,k-1}}c'(v_i,v_{i+1})>0$. Считаем путь простым (если путь не простой, выкенем цикл, получится простой путь). Определим функцию $f_2(u,v)=\sum\limits_{i=0}^{k-1}\left\{\begin{array}{rc}
 M, & (v_i,v_{i+1})=(u,v)\\
-M, & (v_i,v_{i+1})=(v,u)\\
\end{array}\right.$. Поскольку путь простой, то каждое (неориентированное) ребро встречается в нем только один раз. Значит, в сумме максимум один элемент ненулевой, и получаем $f_2(u,v)=\left\{\begin{array}{rl}
M, & \exists i\colon (u,v)=(v_i,v_{i+1})\\
-M, & \exists i\colon (v,u)=(v_i,v_{i+1})\\
0, & \mbox{иначе}
\end{array}\right.$
:\begin{enumerate}
\item $f_2(u,v)=\left\{\begin{array}{rl}
M, & \exists i\colon (u,v)=(v_i,v_{i+1})\\
-M, & \exists i\colon (v,u)=(v_i,v_{i+1})\\
0, & \mbox{иначе}
\end{array}\right.=\left\{\begin{array}{rl}
-M, & \exists i\colon (v,u)=(v_i,v_{i+1})\\
M, & \exists i\colon (u,v)=(v_i,v_{i+1})\\
0, & \mbox{иначе}
\end{array}\right.=-\left\{\begin{array}{rl}
M, & \exists i\colon (v,u)=(v_i,v_{i+1})\\
-M, & \exists i\colon (u,v)=(v_i,v_{i+1})\\
0, & \mbox{иначе}
\end{array}\right.=\\=-f_2(v,u)$, поэтому для $f_2$ и $N$ выполнено свойство \ref{defFs}
\item Фиксируем $u\in V\setminus\{t,s\}$. \begin{enumerate}
\item Пусть $u$ не входит в увеличивающий путь. Тогда $\forall v\in V\,\forall i\in\overline{0,k-1}\hookrightarrow (u,v)\neq(v_i,v_{i+1})$, значит, $f_2(u,v)=0$, и $\sum\limits_{v\in V}f_2(u,v)=0$.
\item Пусть $u$ входит в увеличивающий путь. $u\neq s\,\wedge u\neq t$, поэтому $u$~--- не первая, и не последняя вершина в пути. Значит, $\exists v_1,v_2\colon (v_1,u),\, (u,v_2)$~--- смежные ребра из пути, и других ребер из пути, инцидентных $u$ нет (путь простой). Тогда $\sum\limits_{v\in V}f_2(u,v)=0+...+0+f_2(u,v_1)+f_2(u,v_2)+0+...+0=(-M)+M=0\,\blacksquare$
\end{enumerate}
Получаем для $f_2$ свойство \ref{defFc}
\item $f_2(u,v)=\left\{\begin{array}{rlc}
M, & \exists i\colon (u,v)=(v_i,v_{i+1}) & (1)\\
-M, & \exists i\colon (v,u)=(v_i,v_{i+1}) & (2)\\
0, & \mbox{иначе} & (3)
\end{array}\right.$\begin{enumerate}
\item [(1).] $\exists i\colon (u,v)=(v_i,v_{i+1})$. $f_2(u,v)=M=\min\limits_{j\in\overline{0,k-1}}c'(v_j,v_{j+1})\leqslant c'(v_i,v_{i+1})$ (минимум меньше каждого)
\item [(2).] $\exists i\colon (v,u)=(v_i,v_{i+1})$. $f_2(u,v)=-M<0\leqslant c'(u,v)$ (пропускная способность $c'=c-f_1$ неотрицательна, так как $f_1$~--- поток в $N$, откуда $f_1\leqslant c$).
\item [(3).] $f_2(u,v)=0\leqslant c'(u,v)$ (пропускная способность неотрицательна)
\end{enumerate}
Получаем, что для $f_2$ выполнено свойство $\ref{defFl}$ для сети $N'$
\end{enumerate}
Получаем, что $f_2$~--- поток в $N'$. Докажем, что $f_1+f_2$~--- поток в $N$. По \ref{Fsum} это выполнено, если $\forall (u,v)\in V^2\hookrightarrow f_1(u,v)+f_2(u,v)\leqslant c(u,v)$. Фиксируем $(u,v)\in V^2$. $f_2$~--- поток в $N'$, поэтому $f_2(u,v)\leqslant c'(u,v)\equiv c(u,v)-f_1(u,v)$, поэтому $f_1(u,v)+f_2(u,v)\leqslant f_1(u,v)+c(u,v)-f_1(u,v)\equiv c(u,v)\,\blacksquare$\newline
Докажем, что $f_1+f_2$~--- поток в исходной сети $N$ после этой итерации ФФ: алгоритм добавляет к $f_1(v_i,v_{i+1})$ величину $M$, вычитает из $f_1(v_{i+1},v_i)$ $M$. Рассмотрим разность $(f_1+f_2)-f_1=f_2$, которая как равна этой величине ($M$ в случае $(v_i,v_{i+1})$ в пути, $-M$ в случае $(v_{i+1},v_i)$ в пути, $0$ иначе) $\blacksquare$
\subsection*{(каноническое) Задача 28}
\subsection*{(каноническое) Задача 29}
\newpage
\subsection*{(каноническое) Задача 30}
Пусть $G(V,E)$~--- двудольный граф с долями $L$ и $R$. Считаем, что $E\subseteq L\times R$ (только слева направо). Задача: найти максимальное по мощности $E_0\subseteq E$, такое что любые два ребра из $E_0$ не смежны, то есть, каждая вершина $v\in V$ инцидентна не более, чем одному ребру из $E'$. Определим $G'(V',E')$: $$V'=V\cup\{s,t\}.\,E'=(\bigcup\limits_{l\in L}\{(s,l)\})\cup E\cup (\bigcup\limits_{r\in R}\{(r,t)\}).$$
Задададим все пропускные способности $c(u,v)=\begin{cases}
1, & (u,v)\in E'\\
0, & (u,v)\notin E'\\
\end{cases}$. Тогда $N\eqdef (G',c,s,t)$~--- транспортная сеть.\newline
Обозначим $a=|L|,\,b=|R|$. Хуёвая картинка, которая ни о чем не говорит:\newline
\begin{tikzpicture}[shorten >=1pt,node distance=1.3cm,on grid,auto,initial text=]
	  \node[state] (l1) {$l_1$};
	  \node[state] (l2) [below = of l1] {$l_2$};
	  \node (ld) [below = of l2] {$...$};
	  \node[state] (lm1) [below = of ld] {$l_{a-1}$};
	  \node[state] (l) [below = of lm1] {$l_{a}$};
	  \node[state] (s) [left = 3cm of ld] {$s$};
	  \node[state] (r1) [right = 3cm of l1] {$r_1$};
	  \node[state] (r2) [below = of r1] {$r_2$};
	  \node (rd) [below = of r2] {$...$};
	  \node[state] (rm1) [below = of rd] {$r_{b-1}$};
	  \node[state] (r) [below = of rm1] {$r_{b}$};
	  \node[state] (t) [right = 3cm of rd] {$t$};
  	  \path[->] 
			(s)	edge node {$1$}	(l1)
			(s)	edge node[swap] {$1$}	(l2)
			(s)	edge node {$1$}	(lm1)
			(s)	edge node {$1$}	(l)
			(r1)	edge node {$1$}	(t)
			(r2)	edge node[swap] {$1$}	(t)
			(rm1)	edge node {$1$}	(t)
			(r)	edge node {$1$}	(t)
			(l1)	edge node {$1$}	(r2)
			(l)	edge [out=50,in=200] node {$1$}	(r1)
			(l2)	edge [out=-40,in=190] node {$1$}	(rm1)
			;
\end{tikzpicture}\newline
Пусть $f$~--- поток в $N$. Тогда $|f|$ задает некоторое паросочетание $E_0$, причем $|f|=|E_0|$\begin{enumerate}
\item Вершина $s$ соединена только с вершинами из $L$. Фиксируем одну $l\in L$. Предположим, что $f(s,l)<0$. Тогда (\ref{defFs}) $f(l,s)>0$. Но $c(l,s)=0$, так как так как $(l,s)\notin E'$. Получаем противоречие (\ref{defFl}): $f(l,s)>0=c(l,s)$. Значит, $f(s,l)\geqslant 0$, т.е. $f(s,l)\in \{0,1\}$.
\item \label{tl5} Обозначим $L_0=\{l\in L\big| f(s,l)=1\}$. Тогда $f(s,L)=|L_0|$, так как $c(\cdot,\cdot)\in\{0,1\}$. $s$ инцидентна только вершинам из $L$, поэтому для остальных вершин $v\notin L$ по \ref{uvvu0} имеем $f(s,v)=0$. Значит, $f(s,V)=|L_0|$. Аналогично получаем $f(r,t)\geqslant 0$, обозначим $R_0=\{r\in R\big| f(r,t)=1\}$, и $f(R,t)\equiv f(V,t)=|R_0|$. Но по \ref{fst} $f(s,V)=f(V,t)$, откуда $|L_0|=|R_0|$.
\item \label{tl2} Фиксируем $l\in L$. Пусть $l\in L_0$. Тогда $\exists!r\in R\colon f(l,r)=1$:\begin{enumerate}
\item \label{tl1} Фиксируем $r\in R$. Пусть $f(l,r)<0$. Тогда $f(r,l)>0$. Но $(r,l)\notin E\subseteq L\times R$, откуда $c(r,l)=0<f(r,l)$~--- противоречие (\ref{defFl})
\item ($\exists$) Пусть иначе. Тогда $\forall r\in R\hookrightarrow f(l,r)\leqslant 0$. Из \ref{tl1} получаем, что $f(l,r)=0$. Тогда $f(l,R)=0$. Но $l$ и $t$ не смежны, поэтому (свойство \ref{uvvu0}) $f(l,V\setminus\{s\})=0$. Получим $0\overset{\ref{defFc}}{=}f(l,V)\overset{\ref{FAu}}{=}f(l,s)+f(l,V\setminus\{s\})$. Первое слагаемое равно $-1$, так как $f(s,l)=1$ ($l\in L_0$), второе равно нулю, получаем $0=-1$~--- противоречие $\,\blacksquare$
\item ($!$) Пусть иначе. Поскольку $\forall r\in R\hookrightarrow f(l,r)\geqslant 0$ (\ref{tl1}), найдем $0\overset{\ref{defFc}}{=}f(l,V)\overset{\ref{FAu}}{=}\underbrace{f(l,s)}_{=-1}+\cancelto{0}{f(l,t)}+\cancelto{0}{f(l,L)}+\underbrace{f(l,R)}_{\geqslant 2}\geqslant 1$~--- противоречие.
\end{enumerate}
\item \label{tl3} Пусть $l\in L_0$, $r\in R$: $f(l,r)>0$. Тогда $r\in R_0$. Пусть иначе. Тогда $f(r,t)=0$ (ребра $(t,r)$ нет в $E'$). Получаем $f(r,V)=f(r,l)+f(r,t)=-1\neq 0$~--- противоречие с $\ref{defFc}$.
\item \label{tl4} Пусть $r\in R_0$. Тогда $\exists l\in L\colon f(l,r)=1$. Пусть иначе. $r$ смежна (возможно) только с вершинами из $L$, поэтому $f(r,V)=\underbrace{f(r,t)}_{=1}+\cancelto{0}{f(r,L)}=1$~--- противоречие. По \ref{tl3} эта существующая $l\in L_0$.
\item Построена функция $E_0\colon L_0\to R_0$. Действительно, для каждой $l\in L$ найдена единственная (\ref{tl2}) вершина $r\in R_0$ (\ref{tl3}). По \ref{tl4} эта функция сюръективная (все значения достигаются), и по \ref{tl5} она~--- биекция ($|R_0|=|L_0|$). Значит, $E_0$~--- паросочетание $\blacksquare$
\item Было доказано (\ref{tl5}), что $|L_0|=|R_0|=f(s,V)\equiv |f|$, откуда мощность паросочетания равна величине потока $\blacksquare$
\end{enumerate}
\subsection*{(каноническое) Задача 31}
\end{document}